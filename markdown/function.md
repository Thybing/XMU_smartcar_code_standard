# 函数编写相关代码规范  

## 函数编写基本原则  

### 原则1 一个函数仅完成一件功能，即单一职责。  

说明：一个函数实现多个功能给开发、使用、维护都带来很大的困难。  
将没有关联或者关联很弱的语句放到同一函数中，会导致函数职责不明确，难以理解，难以测试和改动。  

### 原则2 重复代码应该尽可能提炼成函数。  

说明：重复代码提炼成函数可以带来维护成本的降低。如果每次出现新需求时将某些代码进行简单的拷贝，那么未来一旦要对这些重复使用的代码进行修改或替换，就会面临着大批量的修改，非常容易遗漏导致错误，大大增加了代码的维护难度。  

## 函数编写具体规则  

### 规则1 避免函数过长  

说明：过长的函数往往意味着函数功能不单一，过于复杂，编写函数时应实时考虑单一职责原则。  

### 规则2 避免函数的代码块嵌套过深  

说明：函数的代码块嵌套深度指的是函数中的代码控制块（例如：if、for、while、switch等）之间互相包含的深度。每级嵌套都会增加阅读代码时的脑力消耗，因为需要在脑子里维护函数运行流程的上下文信息（比如，进入条件语句、进入循环……）。应该做进一步的功能分解，从而避免使代码的阅读者一次记住太多的上下文。

### 规则3 对参数进行合法性检查。

说明：在函数开始时应对函数的参数进行合法性检查，并且在出现异常情况时提前返回。这种做法保证函数内部处理过程中的参数有效，简化处理逻辑，还可以快速定位程序中意外情况的出现，方便调试代码（如逐飞的debug库中的zf_assert，可以帮助我们快速定位错误）。

## 函数编写相关建议

### 建议1 函数参数尽量使用const进行修饰。

说明：C语言中的const并不仅仅可以用于修饰变量，还可以用于修饰参数，指针等。const除了语法层面的修改限制，还有着“语义”层面向使用或维护该函数的人说明该参数不可变的意义，所以编写函数时尽量使用const，使代码更易理解且更安全。

### 建议2 函数应避免使用全局变量、静态局部变量。

### 建议3 函数的参数个数一般不要超过5个，超过时考虑是否遵循了函数的单一职责原则。

### 建议4 在文件内部使用的函数，应该使用static修饰，防止污染全局命名空间。

说明：static关键字在修饰函数和全局变量时，意味着该函数/全局变量仅在该文件内可见。

### 建议5 在编写较为完整的模块时，可以将模块的底层操作进行封装。

说明：我们在编写智能车相关代码时，绝大多数情况都是基于逐飞对于单片机库函数的二次封装。不同的单片机对外提供的接口不同，并且同一个单片机的库函数本身可能会有更新。所以为了我们编写的模块的可移植性和可维护性，我们可以将模块使用的底层函数抽象成一类行为并且自己加以封装。使我们在使用模块时，只需简单修改模块的底层行为的实现，就可以适应不同的单片机环境。