# 常量、宏相关代码规范  

## 常量、宏相关规则  

### 规则1 用宏定义表达式时，要使用完备的括号。

说明：因为宏只是简单的代码替换，不会像函数一样先将参数计算后，再传递。所以在宏的表达式中，要将参数加上单独的括号。例如：

```c
#define RECTANGLE_AREA(a, b) ((a) * (b))
```

### 规则2 将宏所定义的多条表达式放在do..while(0)中。

说明：常见宏用法，不过请尽量使用函数替代宏

### 规则3 使用宏时，不允许参数发生变化。

说明：宏是字符替换，参数的表达式中存在的副作用可能会被多次执行。错误示例：

```c
#define SQUARE(a) ((a) * (a))
int a = 5;
int b;
b = SQUARE(a++); // 结果：a = 7，即执行了两次增。
```

### 规则4 不允许直接使用魔鬼数字。

说明：魔鬼数字指直接写死在程序代码中，且不是用来给变量赋值的数字。

解决途径：

对于局部使用的唯一含义的魔鬼数字，可以在代码周围增加说明注释，也可以定义局部const变量，变量命名自注释。

对于广泛使用的数字，必须定义const全局变量/宏；同样变量/宏命名应是自注释的。

## 相关建议

### 建议1 除非必要，应尽可能使用函数代替宏。

宏缺乏类型检查，不如函数调用检查严格。

宏展开可能会产生意想不到的副作用，如规则3中示例

以宏形式写的代码难以调试难以打断点，不利于定位问题。

宏如果调用的很多，会造成代码空间的浪费，不如函数空间效率高。

### 建议2 常量建议使用const定义代替宏。

```c
#define PI 3.1415926
//使用static const常量代替
static const double PI = 3.1415926;
```
